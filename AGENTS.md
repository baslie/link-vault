# Инструкции для ИИ-агента по проекту "Link Vault"

## Назначение документа
Этот файл задает единый порядок работы ИИ-агента, который выступает одновременно как product owner, системный аналитик, UX/UI-эксперт и agile/scrum master. Следуй указаниям, сформированным на основе материалов из `docs/brief.md` и `docs/architecture.md`, чтобы поэтапно построить сервис "Link Vault" и обеспечить прозрачную фиксацию прогресса.

## Общие правила работы
1. **Ориентируйся на бриф и архитектурное описание.** Все решения должны соответствовать заявленным требованиям по функционалу, технологиям и приоритетам.
2. **Работай итеративно.** Заверши текущую задачу и отметь ее статус, прежде чем переходить к следующей. Разрешенные значения статуса: `не выполнена`, `не завершена`, `выполнена`.
3. **Практикуй TDD/BDD-подход.** Для каждой функциональной задачи сначала определяй ожидаемое поведение и тесты, затем реализуй код, в конце запускай проверки и обновляй статус.
4. **Поддерживай документацию.** Актуализируй инструкции, схемы и миграции одновременно с кодом. Все артефакты, указанные в таблицах задач, должны появляться в репозитории.
5. **Соблюдай архитектурные ограничения.** Фронтенд: Next.js 14 (App Router) + TypeScript + Shadcn/ui + Tailwind + React Query + Zod. Бэкенд: Supabase (PostgreSQL, Auth, Storage). Учитывай выбор технологий для тем, аналитики и интеграций.
6. **Не реализуй отложенные функции** до тех пор, пока они не попадут в план работ (см. раздел "Дополнительные функции" в брифе).
7. **Качество превыше скорости.** Поддерживай покрытие тестами, следи за производительностью, доступностью и адаптивностью.

## Источники требований
- `docs/brief.md` — продуктовый бриф, сценарии, приоритеты, UX-ожидания.
- `docs/architecture.md` — целевая архитектура, структура данных, маршруты, инфраструктура.
Всегда перепроверяй решения по этим документам и ссылайся на них в описаниях коммитов и PR.

## Управление задачами и статусами
- Приступая к задаче, измени ее статус на `не завершена` и зафиксируй это в таблице.
- После успешного выполнения всех критериев и прохождения тестов измени статус на `выполнена`.
- Если задача была начата, но завершить ее не удалось, зафиксируй промежуточный результат и оставь статус `не завершена`.
- Не перескакивай между задачами внутри этапа. Исключения возможны только при блокирующих зависимостях и должны быть документированы в сопроводительном тексте коммита/PR.

## Минимальный набор проверок качества
- `pnpm lint` — линтинг (ESLint + Prettier).
- `pnpm typecheck` — статический анализ TypeScript (`tsc --noEmit`).
- `pnpm test` — unit и integration тесты (Jest/RTL).
- `pnpm test:e2e` — end-to-end сценарии (Playwright/Cypress).
- `pnpm test:a11y` — автоматизированные проверки доступности (axe/core) при наличии.
- `supabase db lint` / `supabase db test` (или эквивалентный набор команд) — валидация миграций и политик RLS.
Уточняй и дополняй список по мере развития проекта. Каждая задача в таблицах содержит минимальный набор проверок; запускай их по завершении задачи.

## Дорожная карта реализации
Задачи сгруппированы по этапам. Выполняй этапы последовательно сверху вниз. Все статусы по умолчанию установлены в `не выполнена`.

### Этап 1. Инициализация и инфраструктура
| ID | Задача | Цель и ключевые действия | Артефакты | Минимальные проверки | Статус |
| --- | --- | --- | --- | --- | --- |
| ARCH-1 | Сформировать скелет проекта | Создай репозиторий Next.js 14 с TypeScript, Tailwind, Shadcn/ui, React Query, Zod. Настрой базовую структуру директорий, ESLint/Prettier, Husky/lint-staged. | Базовый layout, конфигурации lint/test, подключенный Tailwind и Shadcn. | `pnpm lint`, `pnpm test -- --watch=false` (заглушки), `pnpm typecheck`. | не выполнена |
| ARCH-2 | Интегрировать Supabase и миграции | Настрой `.env` переменные, подключи Supabase client, опиши миграции для таблиц `profiles`, `links`, `tags`, `link_tags` и необходимых индексов/RLS. | Миграции, seed-данные для локальной разработки, Supabase CLI конфиг. | `supabase db push --dry-run`, `pnpm test --filter db`, `pnpm lint`. | не выполнена |
| ARCH-3 | Реализовать аутентификацию | Подключи Supabase Auth (Email + Google), определи guard-компоненты, обнови UI входа/регистрации, обеспечь хранение профиля. | Страницы `/auth/*`, server actions для входа/выхода, тестовые данные пользователя. | `pnpm test --filter auth`, `pnpm lint`, e2e сценарий логина (`pnpm test:e2e -- --project auth`). | не выполнена |
| ARCH-4 | Построить базовый UI каркас | Реализуй общий layout, header с глобальным поиском-заглушкой, переключатель темы (light/dark/system), responsive контейнеры. | Компоненты layout, ThemeProvider, Snapshot-тесты. | `pnpm test --filter ui`, `pnpm test:a11y`, визуальные тесты (Chromatic/Storybook). | не выполнена |

### Этап 2. Базовый функционал ссылок (MVP 1.0)
| ID | Задача | Цель и ключевые действия | Артефакты | Минимальные проверки | Статус |
| --- | --- | --- | --- | --- | --- |
| MVP-1 | Доменная модель и RLS | Допиши миграции и политики RLS для операций CRUD по ссылкам и тегам. Настрой триггеры даты, ограничения уникальности и представления для выборок. | SQL-миграции, документация схемы, unit-тесты SQL (если возможно). | `supabase db push`, `supabase db test`, `pnpm test --filter db`. | не выполнена |
| MVP-2 | API и слой данных | Реализуй React Query hooks, server components и API routes для чтения списка ссылок с фильтрами, сортировками, пагинацией. | `useLinksQuery`, `useTagsQuery`, API `/api/links`. | `pnpm test --filter data`, интеграционные тесты API (`pnpm test --filter api`). | не выполнена |
| MVP-3 | Управление ссылками | Построй форму создания/редактирования/удаления ссылок, валидацию через Zod, автоподстановку title и фавиконок через metadata-сервис (заглушка). | `LinkForm`, мутации React Query, unit-тесты валидации. | `pnpm test --filter links`, e2e сценарий создания (`pnpm test:e2e -- --project links`). | не выполнена |
| MVP-4 | Таблица/список ссылок | Реализуй компонент таблицы с колонками favicon, title, URL, comment, tags, date и действиями. Добавь inline-редактирование, кликабельные URL, управление тегами в строке. | `LinksTable`, storybook stories, accessibility тесты. | `pnpm test --filter table`, `pnpm test:a11y`, визуальные тесты. | не выполнена |
| MVP-5 | Система тегов и фильтров | Обеспечь отображение тегов-пилюль, множественный выбор с логикой AND, кнопку "Сбросить все", редактирование/удаление тегов. | `TagBar`, мутации тегов, e2e сценарий фильтрации. | `pnpm test --filter tags`, `pnpm test:e2e -- --project filters`. | не выполнена |
| MVP-6 | Поиск, сортировки и адаптивность | Добавь полнотекстовый поиск по title/url/comment/tags, подсветку совпадений, сортировки по дате и названию, responsive-режимы таблицы/карточек. | Search компонент, SQL индекс для поиска, мобильные карточки. | `pnpm test --filter search`, `pnpm test:e2e -- --project search`, Lighthouse чек. | не выполнена |

### Этап 3. Управление данными и импорт/экспорт
| ID | Задача | Цель и ключевые действия | Артефакты | Минимальные проверки | Статус |
| --- | --- | --- | --- | --- | --- |
| DATA-1 | Сервис метаданных и фавиконок | Реализуй API `/api/metadata` для получения title и favicon с кэшированием в Supabase Storage. Обработай ошибки и fallback-иконки. | API route, storage bucket `favicons`, unit-тесты на парсер. | `pnpm test --filter metadata`, `pnpm lint`, интеграционные тесты API. | не выполнена |
| DATA-2 | Импорт CSV | Сделай загрузку CSV с предпросмотром, маппингом полей, дедупликацией URL, списком ошибок. | UI `/import`, backend `/api/import/*`, e2e сценарий импорта. | `pnpm test --filter import`, `pnpm test:e2e -- --project import`, `pnpm lint`. | не выполнена |
| DATA-3 | Экспорт CSV | Реализуй экспорт текущей выборки/всех данных/выбранных записей, инициируемый из профиля. | `/export` страница, API `/api/export`, unit-тесты форматирования. | `pnpm test --filter export`, `pnpm test:e2e -- --project export`. | не выполнена |
| DATA-4 | Управление тегами и настройками профиля | Добавь UI для редактирования тегов, выбора цветов, настройку темы/настроек профиля. | Настройки `/settings`, формы редактирования тегов. | `pnpm test --filter settings`, `pnpm test:a11y`. | не выполнена |

### Этап 4. Администрирование и аналитика
| ID | Задача | Цель и ключевые действия | Артефакты | Минимальные проверки | Статус |
| --- | --- | --- | --- | --- | --- |
| ADMIN-1 | Админ-панель статистики | Создай страницу `/admin` с метриками: число пользователей, ссылки по пользователям, график активности, популярные теги. | Агрегирующие SQL-вьюхи, визуализации (charts). | `pnpm test --filter admin`, e2e сценарий просмотра. | не выполнена |
| ADMIN-2 | Интеграция аналитики | Подключи Яндекс.Метрику и Google Analytics, настрой события (добавление ссылки, импорт, экспорт, переключение темы). | Компонент аналитики, конфиг окружения. | `pnpm lint`, smoke-тесты (`pnpm test --filter analytics`). | не выполнена |
| ADMIN-3 | Мониторинг производительности и ошибок | Настрой логирование (например, Sentry/Vercel Analytics), проверь показатели загрузки <2с, поиск <500мс. | Документация мониторинга, настройки в env. | `pnpm test --filter perf`, Lighthouse/ Web Vitals проверка. | не выполнена |

### Этап 5. Релиз, эксплуатация и инструкции
| ID | Задача | Цель и ключевые действия | Артефакты | Минимальные проверки | Статус |
| --- | --- | --- | --- | --- | --- |
| OPS-1 | Финализация тестового контура | Обнови и дополни unit/integration/e2e тесты, настрой покрытие, обеспечь автоматический запуск при коммитах. | Отчеты покрытия, README раздел "Тестирование". | `pnpm test --coverage`, `pnpm test:e2e`, `pnpm test:a11y`. | не выполнена |
| OPS-2 | CI/CD и деплой | Настрой GitHub Actions: lint, tsc, tests, деплой на Vercel, прогон миграций Supabase. Опиши процесс rollback. | `.github/workflows/*`, инструкции по деплою. | Запуск pipeline в тестовом режиме, `supabase db push` в CI. | не выполнена |
| OPS-3 | Полный runbook запуска сервиса | Подготовь детальные пошаговые инструкции по запуску проекта: настройка Supabase с нуля, переменные окружения, локальный запуск (`pnpm dev` + `supabase start`), деплой на Vercel, проверка работоспособности. Размести runbook в `docs/DEPLOYMENT.md` и обнови README. | `docs/DEPLOYMENT.md`, обновленный README (раздел "Запуск"). | `pnpm lint`, ручная проверка инструкций (checklist), при необходимости smoke-тест деплоя. | не выполнена |

## Дополнительные указания
- В конце каждого этапа проводи ретроспективу: фиксируй в PR summary, какие требования из брифа/архитектуры выполнены и какие риски остаются.
- При появлении новых требований добавляй их в отдельный раздел этого файла, не нарушая основную последовательность.
- Если задача требует уточнений, документируй принятые решения в `docs/adr/` в формате ADR.
- Перед закрытием задачи убедись, что UI соответствует принципам минималистичного дизайна и адаптивности, описанным в брифе.

Следуя этим инструкциям и таблицам, агент сможет поэтапно реализовать "Link Vault", сохраняя прозрачный прогресс и качество продукта.
