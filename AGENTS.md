# Инструкции для ИИ-агента по проекту "Link Vault"

## Назначение документа

Этот файл задает единый порядок работы ИИ-агента, который выступает одновременно как product owner, системный аналитик, UX/UI-эксперт и agile/scrum master. Следуй указаниям, сформированным на основе материалов из `docs/brief.md` и `docs/architecture.md`, чтобы поэтапно построить сервис "Link Vault" и обеспечить прозрачную фиксацию прогресса.

## Общие правила работы

1. **Ориентируйся на бриф и архитектурное описание.** Все решения должны соответствовать заявленным требованиям по функционалу, технологиям и приоритетам.
2. **Работай итеративно.** Заверши текущую задачу и отметь ее статус, прежде чем переходить к следующей. Разрешенные значения статуса: `не выполнена`, `не завершена`, `выполнена`.
3. **Практикуй TDD/BDD-подход.** Для каждой функциональной задачи сначала определяй ожидаемое поведение и тесты, затем реализуй код, в конце запускай проверки и обновляй статус.
4. **Поддерживай документацию.** Актуализируй инструкции, схемы и миграции одновременно с кодом. Все артефакты, указанные в таблицах задач, должны появляться в репозитории.
5. **Соблюдай архитектурные ограничения.** Фронтенд: Next.js 14 (App Router) + TypeScript + Shadcn/ui + Tailwind + React Query + Zod. Бэкенд: Supabase (PostgreSQL, Auth, Storage). Учитывай выбор технологий для тем, аналитики и интеграций.
6. **Не реализуй отложенные функции** до тех пор, пока они не попадут в план работ (см. раздел "Дополнительные функции" в брифе).
7. **Качество превыше скорости.** Поддерживай покрытие тестами, следи за производительностью, доступностью и адаптивностью.

## Источники требований

- `docs/brief.md` — продуктовый бриф, сценарии, приоритеты, UX-ожидания.
- `docs/architecture.md` — целевая архитектура, структура данных, маршруты, инфраструктура.
  Всегда перепроверяй решения по этим документам и ссылайся на них в описаниях коммитов и PR.

## Управление задачами и статусами

- Приступая к задаче, измени ее статус на `не завершена` и зафиксируй это в таблице.
- После успешного выполнения всех критериев и прохождения тестов измени статус на `выполнена`.
- Если задача была начата, но завершить ее не удалось, зафиксируй промежуточный результат и оставь статус `не завершена`.
- Не перескакивай между задачами внутри этапа. Исключения возможны только при блокирующих зависимостях и должны быть документированы в сопроводительном тексте коммита/PR.

## Минимальный набор проверок качества

- `pnpm lint` — линтинг (ESLint + Prettier).
- `pnpm typecheck` — статический анализ TypeScript (`tsc --noEmit`).
- `pnpm test` — unit и integration тесты (Jest/RTL).
- `pnpm test:e2e` — end-to-end сценарии (Playwright/Cypress).
- `pnpm test:a11y` — автоматизированные проверки доступности (axe/core) при наличии.
- `supabase db lint` / `supabase db test` (или эквивалентный набор команд) — валидация миграций и политик RLS.
  Уточняй и дополняй список по мере развития проекта. Каждая задача в таблицах содержит минимальный набор проверок; запускай их по завершении задачи.

## Дорожная карта реализации

Задачи сгруппированы по этапам. Выполняй этапы последовательно сверху вниз. Все статусы по умолчанию установлены в `не выполнена`.

### Этап 1. Инициализация и инфраструктура

| ID  | Задача                            | Цель и ключевые действия                                                                                                                                     | Артефакты                                                                          | Минимальные проверки                                                                             | Ссылки                                                                                                                                  | Статус    |
| --- | --------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------- | --------- |
| 1-1 | Сформировать скелет проекта       | Создай репозиторий Next.js 14 с TypeScript, Tailwind, Shadcn/ui, React Query, Zod. Настрой базовую структуру директорий, ESLint/Prettier, Husky/lint-staged. | Базовый layout, конфигурации lint/test, подключенный Tailwind и Shadcn.            | `pnpm lint`, `pnpm test -- --watch=false` (заглушки), `pnpm typecheck`.                          | [Архитектура — 1-1](docs/architecture.md#1-1-скелет-проекта)                                                                            | выполнена |
| 1-2 | Интегрировать Supabase и миграции | Настрой `.env` переменные, подключи Supabase client, опиши миграции для таблиц `profiles`, `links`, `tags`, `link_tags` и необходимых индексов/RLS.          | Миграции, seed-данные для локальной разработки, Supabase CLI конфиг.               | `supabase db push --dry-run`, `pnpm test --filter db`, `pnpm lint`.                              | [Архитектура — 1-2](docs/architecture.md#1-2-интеграция-supabase-и-миграции)                                                            | выполнена |
| 1-3 | Реализовать аутентификацию        | Подключи Supabase Auth (Email + Google), определи guard-компоненты, обнови UI входа/регистрации, обеспечь хранение профиля.                                  | Страницы `/auth/*`, server actions для входа/выхода, тестовые данные пользователя. | `pnpm test --filter auth`, `pnpm lint`, e2e сценарий логина (`pnpm test:e2e -- --project auth`). | [Архитектура — 1-3](docs/architecture.md#1-3-аутентификация)<br>[Бриф — auth UX](docs/brief.md#регистрация-и-авторизация-пользователей) | выполнена |
| 1-4 | Построить базовый UI каркас       | Реализуй общий layout, header с глобальным поиском-заглушкой, переключатель темы (light/dark/system), responsive контейнеры.                                 | Компоненты layout, ThemeProvider, Snapshot-тесты.                                  | `pnpm test --filter ui`, `pnpm test:a11y`, визуальные тесты (Chromatic/Storybook).               | [Архитектура — 1-4](docs/architecture.md#1-4-базовый-ui-каркас)<br>[Бриф — интерфейс](docs/brief.md#структура-интерфейса)               | выполнена |

### Этап 2. Базовый функционал ссылок (MVP 1.0)

| ID  | Задача                           | Цель и ключевые действия                                                                                                                                                  | Артефакты                                                         | Минимальные проверки                                                                    | Ссылки                                                                                                                                                                                                                            | Статус    |
| --- | -------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------- | --------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- |
| 2-1 | Доменная модель и RLS            | Допиши миграции и политики RLS для операций CRUD по ссылкам и тегам. Настрой триггеры даты, ограничения уникальности и представления для выборок.                         | SQL-миграции, документация схемы, unit-тесты SQL (если возможно). | `supabase db push`, `supabase db test`, `pnpm test --filter db`.                        | [Архитектура — 2-1](docs/architecture.md#2-1-доменная-модель-и-rls)                                                                                                                                                               | выполнена |
| 2-2 | API и слой данных                | Реализуй React Query hooks, server components и API routes для чтения списка ссылок с фильтрами, сортировками, пагинацией.                                                | `useLinksQuery`, `useTagsQuery`, API `/api/links`.                | `pnpm test --filter data`, интеграционные тесты API (`pnpm test --filter api`).         | [Архитектура — 2-2](docs/architecture.md#2-2-api-и-слой-данных)                                                                                                                                                                   | выполнена |
| 2-3 | Управление ссылками              | Построй форму создания/редактирования/удаления ссылок, валидацию через Zod, автоподстановку title и фавиконок через metadata-сервис (заглушка).                           | `LinkForm`, мутации React Query, unit-тесты валидации.            | `pnpm test --filter links`, e2e сценарий создания (`pnpm test:e2e -- --project links`). | [Архитектура — 2-3](docs/architecture.md#2-3-управление-ссылками)<br>[Бриф — CRUD](docs/brief.md#добавление-и-редактирование-ссылок)                                                                                              | выполнена |
| 2-4 | Таблица/список ссылок            | Реализуй компонент таблицы с колонками favicon, title, URL, comment, tags, date и действиями. Добавь inline-редактирование, кликабельные URL, управление тегами в строке. | `LinksTable`, storybook stories, accessibility тесты.             | `pnpm test --filter table`, `pnpm test:a11y`, визуальные тесты.                         | [Архитектура — 2-4](docs/architecture.md#2-4-таблица-список-ссылок)<br>[Бриф — таблица](docs/brief.md#основная-таблица)<br>[Бриф — пагинация](docs/brief.md#пагинация)                                                            | выполнена |
| 2-5 | Система тегов и фильтров         | Обеспечь отображение тегов-пилюль, множественный выбор с логикой AND, кнопку "Сбросить все", редактирование/удаление тегов.                                               | `TagBar`, мутации тегов, e2e сценарий фильтрации.                 | `pnpm test --filter tags`, `pnpm test:e2e -- --project filters`.                        | [Архитектура — 2-5](docs/architecture.md#2-5-система-тегов-и-фильтров)<br>[Бриф — теги](docs/brief.md#система-тегов)                                                                                                              | выполнена |
| 2-6 | Поиск, сортировки и адаптивность | Добавь полнотекстовый поиск по title/url/comment/tags, подсветку совпадений, сортировки по дате и названию, responsive-режимы таблицы/карточек.                           | Search компонент, SQL индекс для поиска, мобильные карточки.      | `pnpm test --filter search`, `pnpm test:e2e -- --project search`, Lighthouse чек.       | [Архитектура — 2-6](docs/architecture.md#2-6-поиск-сортировки-и-адаптивность)<br>[Бриф — поиск](docs/brief.md#поиск)<br>[Бриф — фильтры](docs/brief.md#сортировка-и-фильтры)<br>[Бриф — адаптивность](docs/brief.md#адаптивность) | выполнена |

### Этап 3. Управление данными и импорт/экспорт

| ID  | Задача                                  | Цель и ключевые действия                                                                                                          | Артефакты                                                         | Минимальные проверки                                                           | Ссылки                                                                                                                                                    | Статус       |
| --- | --------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------- | ------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------ |
| 3-1 | Сервис метаданных и фавиконок           | Реализуй API `/api/metadata` для получения title и favicon с кэшированием в Supabase Storage. Обработай ошибки и fallback-иконки. | API route, storage bucket `favicons`, unit-тесты на парсер.       | `pnpm test --filter metadata`, `pnpm lint`, интеграционные тесты API.          | [Архитектура — 3-1](docs/architecture.md#3-1-сервис-метаданных-и-фавиконок)<br>[Бриф — доп. функции](docs/brief.md#планируется-реализовать)               | не выполнена |
| 3-2 | Импорт CSV                              | Сделай загрузку CSV с предпросмотром, маппингом полей, дедупликацией URL, списком ошибок.                                         | UI `/import`, backend `/api/import/*`, e2e сценарий импорта.      | `pnpm test --filter import`, `pnpm test:e2e -- --project import`, `pnpm lint`. | [Архитектура — 3-2](docs/architecture.md#3-2-импорт-csv)<br>[Бриф — импорт](docs/brief.md#импорт)                                                         | не выполнена |
| 3-3 | Экспорт CSV                             | Реализуй экспорт текущей выборки/всех данных/выбранных записей, инициируемый из профиля.                                          | `/export` страница, API `/api/export`, unit-тесты форматирования. | `pnpm test --filter export`, `pnpm test:e2e -- --project export`.              | [Архитектура — 3-3](docs/architecture.md#3-3-экспорт-csv)<br>[Бриф — экспорт](docs/brief.md#экспорт)                                                      | не выполнена |
| 3-4 | Управление тегами и настройками профиля | Добавь UI для редактирования тегов, выбора цветов, настройку темы/настроек профиля.                                               | Настройки `/settings`, формы редактирования тегов.                | `pnpm test --filter settings`, `pnpm test:a11y`.                               | [Архитектура — 3-4](docs/architecture.md#3-4-управление-тегами-и-настройками-профиля)<br>[Бриф — профиль](docs/brief.md#профиль-пользователя-и-настройки) | не выполнена |

### Этап 4. Администрирование и аналитика

| ID  | Задача                                 | Цель и ключевые действия                                                                                                | Артефакты                                      | Минимальные проверки                                        | Ссылки                                                                                                                                                                                                 | Статус       |
| --- | -------------------------------------- | ----------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------- | ----------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------ |
| 4-1 | Админ-панель статистики                | Создай страницу `/admin` с метриками: число пользователей, ссылки по пользователям, график активности, популярные теги. | Агрегирующие SQL-вьюхи, визуализации (charts). | `pnpm test --filter admin`, e2e сценарий просмотра.         | [Архитектура — 4-1](docs/architecture.md#4-1-админ-панель-статистики)<br>[Бриф — админка](docs/brief.md#функционал-админки-простой)                                                                    | не выполнена |
| 4-2 | Интеграция аналитики                   | Подключи Яндекс.Метрику и Google Analytics, настрой события (добавление ссылки, импорт, экспорт, переключение темы).    | Компонент аналитики, конфиг окружения.         | `pnpm lint`, smoke-тесты (`pnpm test --filter analytics`).  | [Архитектура — 4-2](docs/architecture.md#4-2-интеграция-аналитики)<br>[Бриф — интеграции](docs/brief.md#интеграции)                                                                                    | не выполнена |
| 4-3 | Мониторинг производительности и ошибок | Настрой логирование (например, Sentry/Vercel Analytics), проверь показатели загрузки <2с, поиск <500мс.                 | Документация мониторинга, настройки в env.     | `pnpm test --filter perf`, Lighthouse/ Web Vitals проверка. | [Архитектура — 4-3](docs/architecture.md#4-3-мониторинг-производительности-и-ошибок)<br>[Бриф — производительность](docs/brief.md#производительность)<br>[Бриф — надежность](docs/brief.md#надежность) | не выполнена |

### Этап 5. Релиз, эксплуатация и инструкции

| ID  | Задача                         | Цель и ключевые действия                                                                                                                                                                                                                                               | Артефакты                                                   | Минимальные проверки                                                                      | Ссылки                                                                                                                                      | Статус       |
| --- | ------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------- | ----------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------- | ------------ |
| 5-1 | Финализация тестового контура  | Обнови и дополни unit/integration/e2e тесты, настрой покрытие, обеспечь автоматический запуск при коммитах.                                                                                                                                                            | Отчеты покрытия, README раздел "Тестирование".              | `pnpm test --coverage`, `pnpm test:e2e`, `pnpm test:a11y`.                                | [Архитектура — 5-1](docs/architecture.md#5-1-финализация-тестового-контура)<br>[Архитектура — тесты](docs/architecture.md#81-уровни-тестов) | не выполнена |
| 5-2 | CI/CD и деплой                 | Настрой GitHub Actions: lint, tsc, tests, деплой на Vercel, прогон миграций Supabase. Опиши процесс rollback.                                                                                                                                                          | `.github/workflows/*`, инструкции по деплою.                | Запуск pipeline в тестовом режиме, `supabase db push` в CI.                               | [Архитектура — 5-2](docs/architecture.md#5-2-cicd-и-деплой)<br>[Архитектура — CI/CD](docs/architecture.md#72-cicd)                          | не выполнена |
| 5-3 | Полный runbook запуска сервиса | Подготовь детальные пошаговые инструкции по запуску проекта: настройка Supabase с нуля, переменные окружения, локальный запуск (`pnpm dev` + `supabase start`), деплой на Vercel, проверка работоспособности. Размести runbook в `docs/DEPLOYMENT.md` и обнови README. | `docs/DEPLOYMENT.md`, обновленный README (раздел "Запуск"). | `pnpm lint`, ручная проверка инструкций (checklist), при необходимости smoke-тест деплоя. | [Архитектура — 5-3](docs/architecture.md#5-3-полный-runbook-запуска-сервиса)<br>[Бриф — инструкции](docs/brief.md#требования-к-инструкциям) | не выполнена |

## Дополнительные указания

- В конце каждого этапа проводи ретроспективу: фиксируй в PR summary, какие требования из брифа/архитектуры выполнены и какие риски остаются.
- При появлении новых требований добавляй их в отдельный раздел этого файла, не нарушая основную последовательность.
- Если задача требует уточнений, документируй принятые решения в `docs/adr/` в формате ADR.
- Перед закрытием задачи убедись, что UI соответствует принципам минималистичного дизайна и адаптивности, описанным в брифе.

Следуя этим инструкциям и таблицам, агент сможет поэтапно реализовать "Link Vault", сохраняя прозрачный прогресс и качество продукта.
